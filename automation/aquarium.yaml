#################################################################
## Aquarium - Notifications and Automations
#################################################################

        ##########################################################
        ## Biocube32 Feed Mode On
        ##########################################################

        - alias: Biocube32 Feed Mode On

          trigger:
            - platform: state
              entity_id: input_boolean.biocube_feed_mode
              to: 'on'
              
          action:
            - service: switch.turn_off
              entity_id:
                - switch.biocube_pump
            - service: switch.turn_off
              entity_id:
                - switch.biocube_wavemaker             
            - service: homeassistant.turn_on
              entity_id: input_boolean.fish_fed_today             

        ##########################################################
        ## Biocube32 Feed Mode Off
        ##########################################################

        - alias: Biocube32 Feed Mode Off

          trigger:
            - platform: state
              entity_id: input_boolean.biocube_feed_mode
              to: 'off'

          action:
            - service: switch.turn_on
              entity_id:
                - switch.biocube_wavemaker
            - delay: "00:03:00"                  
            - service: switch.turn_on
              entity_id:
                - switch.biocube_pump 

        ##########################################################
        ## Biocube32 High Temperature Alert
        ##########################################################

        - alias: Biocube32 High Temperature

          trigger:
            - platform: numeric_state
              entity_id: sensor.biocube_temp
              above: 82
              for:
                hours: 0
                minutes: 20
                seconds: 0

          action:
            - service: switch.turn_off
              entity_id:
                - switch.biocube_heater
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube Temp High - Heater turned Off!"
            - service: notify.mobile_app_USER2s_iphone
              data:
                message: "Biocube Temp High - Heater turned Off!"


        ##########################################################
        ## Biocube32 Low Temperature Alert
        ##########################################################

        - alias: Biocube32 Low Temperature

          trigger:
            - platform: numeric_state
              entity_id: sensor.biocube_temp
              below: 76
              for:
                hours: 0
                minutes: 5
                seconds: 0
          condition:
            - condition: state
              entity_id: input_boolean.biocube_maintenance_mode
              state: 'off'
          action:
            - service: switch.turn_on
              entity_id:
                - switch.biocube_heater
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube Temp Low - Check Tank Temp"
            - service: notify.mobile_app_USER2s_iphone
              data:
                message: "Biocube Temp Low - Check Tank Temp"


        ##########################################################
        ## Biocube32 Pump Left Off After Feeding
        ##########################################################

        - alias: Biocube32 Pump Left Off After Feeding

          trigger:
            - platform: state
              entity_id: switch.biocube_pump
              to: 'off'
              for:
                hours: 0
                minutes: 10
                seconds: 0
          condition:
            - condition: state
              entity_id: input_boolean.fish_fed_today
              state: 'on'
            - condition: state
              entity_id: input_boolean.biocube_maintenance_mode
              state: 'off'
          action:
            - service: homeassistant.turn_off
              entity_id: input_boolean.biocube_feed_mode                
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube Pump Off 10m After Feeding - Turning On!"
            - service: notify.mobile_app_USER2s_iphone
              data:
                message: "Biocube Pump Off 10m After Feeding - Turning On!"

        ##########################################################
        ## Biocube32 Pump Off 15m
        ##########################################################

        - alias: Biocube32 Pump Off 15m

          trigger:
            - platform: state
              entity_id: switch.biocube_pump
              to: 'off'
              for:
                hours: 0
                minutes: 15
                seconds: 0
          condition:
            - condition: state
              entity_id: input_boolean.biocube_maintenance_mode
              state: 'off'
          action:             
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube Pump Off 15m - CHECK PUMP!"
                data:
                  apns_headers:
                  'apns-collapse-id': 'biocubepump-switch'
                  push:
                    badge: 0
                    category: "biocubepumpswitch"                
            - service: notify.mobile_app_USER2s_iphone
              data:
                message: "Biocube Pump Off 15m - CHECK PUMP!"
                data:
                    apns_headers:
                    'apns-collapse-id': 'biocubepump-switch'
                    push:
                      badge: 0
                      category: "biocubepumpswitch"                       

        ##########################################################
        ## Biocube32 Wavemaker Off 20m
        ##########################################################

        - alias: Biocube32 Wavemaker Off 20m

          trigger:
            - platform: state
              entity_id: switch.biocube_wavemaker
              to: 'off'
              for:
                hours: 0
                minutes: 20
                seconds: 0
          condition:
            - condition: state
              entity_id: input_boolean.biocube_maintenance_mode
              state: 'off'
          action:             
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube Wavemaker Off 20m - CHECK Wavemaker!"
                data:
                  apns_headers:
                  'apns-collapse-id': 'biocubewavemaker-switch'
                  push:
                    badge: 0
                    category: "biocubewavemakerswitch"                
            - service: notify.mobile_app_USER2s_iphone
              data:
                message: "Biocube Pump Off 20m - CHECK Wavemaker!"
                data:
                    apns_headers:
                    'apns-collapse-id': 'biocubewavemaker-switch'
                    push:
                      badge: 0
                      category: "biocubewavemakerswitch"   

        ##########################################################
        ## Biocube32 Pump Failure
        ##########################################################







        ##########################################################
        ## Biocube32 Heater Failure
        ##########################################################        





        ##########################################################
        ## Biocube32 ATO Running
        ##########################################################

        - alias: Biocube32 ATO Running
            
          trigger:
            - platform: state
              entity_id: sensor.biocube_ato_status
              from: 'not running'
              to: 'running'

          action:
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube ATO Running"

        ##########################################################
        ## Biocube32 ATO Long Runtime
        ##########################################################  

        - alias: Biocube32 ATO Running LONG
            
          trigger:
            - platform: state
              entity_id: sensor.biocube_ato_status
              from: 'not running'
              to: 'running'
              for:
                hours: 0
                minutes: 3
                seconds: 0              

          action:
            - service: switch.turn_off
              entity_id: switch.biocube_ato          
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube ATO Running LONG 3m - ATO Turned Off"            

        ##########################################################
        ## Biocube32 ATO Tank Low
        ##########################################################

        - alias: Biocube32 ATO Tank Low
            
          trigger:
            - platform: numeric_state
              entity_id: sensor.biocube_32_ato_reservoir_level
              below: 50
              for:
                hours: 0
                minutes: 5
                seconds: 0
          condition:
            - condition: state
              entity_id: input_boolean.biocube_maintenance_mode
              state: 'off'
          action:
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube ATO Tank Needs Filled - Currently at {{states.sensor.biocube_32_ato_reservoir_level.state}}"


        ##########################################################
        ## Biocube32 ATO Off - Disable Pump
        ##########################################################  

        - alias: Biocube32 ATO Off - Disable Pump
            
          trigger:
            - platform: state
              entity_id: switch.biocube_ato
              to: 'off'            

          action:
            - service: switch.turn_on
              entity_id: switch.biocube_ato_relay_disable


        ##########################################################
        ## Biocube32 ATO On - Enable Pump
        ##########################################################  

        - alias: Biocube32 ATO On - Enable Pump
            
          trigger:
            - platform: state
              entity_id: switch.biocube_ato
              from: 'off'
              to: 'on'
              for:
                hours: 0
                minutes: 2
                seconds: 0

          action:
            - service: switch.turn_off
              entity_id: switch.biocube_ato_relay_disable

        ##########################################################
        ## Biocube32 Maintenance Mode - 60m
        ##########################################################

        - alias: Biocube32 Maintenance Mode - 60m

          trigger:
            - platform: state
              entity_id: input_boolean.biocube_maintenance_mode
              to: 'on'
              for:
                hours: 1
                minutes: 0
                seconds: 0

          action:
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Biocube Maintenance Mode Off 60m!"
                data:
                  apns_headers:
                  'apns-collapse-id': 'biocubemaintenance-switch'
                  push:
                    badge: 0
                    category: "biocubemaintenanceswitch"

        ##########################################################
        ## Feed Fish Reminder - USER4
        ##########################################################

        - alias: Feed Fish Reminder - USER4

          trigger:
            - platform: time
              at: '16:15'
          condition:
            condition: and
            conditions:
              - condition: state
                entity_id: input_boolean.fish_fed_today
                state: 'off'
              - condition: or
                conditions:
                  - condition: state
                    entity_id: device_tracker.USER4_iphone
                    state: 'home'
                  - condition: state
                    entity_id: device_tracker.USER4_iphone_xs_unifi
                    state: 'home'         
          action:              
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "USER4 sent reminder to feed fish"
            - service: notify.mobile_app_USER4s_iphone
              data:
                message: "Fish still need fed today"

        ##########################################################
        ## Feed Fish Reminder - All
        ##########################################################

        - alias: Feed Fish Reminder - All

          trigger:
            - platform: time
              at: '16:40'
          condition:
            - condition: state
              entity_id: input_boolean.fish_fed_today
              state: 'off'    
          action:              
            - service: notify.mobile_app_USER1_iphone
              data:
                message: "Reminder fish need fed today"
            - service: notify.mobile_app_USER4s_iphone
              data:
                message: "Reminder fish need fed today"
            - service: notify.mobile_app_USER2s_iphone
              data:
                message: "Reminder fish need fed today"

        ##########################################################
        ## Reset Fed Today Boolean
        ##########################################################

        - alias: Fish Fed Today - Reset Switch

          trigger:
            - platform: time
              at: '00:30'

          action:
            - service: homeassistant.turn_off
              entity_id: input_boolean.fish_fed_today
